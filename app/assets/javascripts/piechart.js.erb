/**
 * Displays the weighted tags in a pie chart
 *
 * @constructor
 */
function Piechart () {

  var colors = [ 
    "#7e3838", 
    "#7a387e",
    "#4d387e", 
    "#38507e", 
    "#386a7e", 
    "#387e6a", 
    "#387e45",
    "#587e38", 
    "#7c7e38", 
    "#7e6538" 
  ];
  var pie = null;

  var setData = function() {
    var data = [];
    
    for (var i=0 ; i < tagger.tags.length ; i++ ) {
      console.log(tagger.tags[i].weight);
      data.push({
        label: tagger.tags[i].name,
        value: tagger.tags[i].weight,
        color: colors[i]
      });
    }
    return data;
  }

  /**
   * Called when just the values of existing tags changes
   * (no animation)
   */
  this.updateVals = function() {
    var data = setData();
    pie.updateProp("effects.load.effect", "none");
    pie.updateProp("data.content", data);
  };

  /**
   * Called whenever a tag is added or removed from the list
   * (full animation)
   */
  this.updateTagList = function() {
    
    // if there are no tags
    if (tagger.tags.length === 0) {
      // draw an empty circle
      return;
    }

    var data = setData();
    
    // if we have already made the pie chart
    if (pie) {

      // switch to animation mode 
      pie.updateProp("effects.load.effect", "default");

      // update the data
      pie.updateProp("data.content", data);

    } else {
      // create the chart
      pie = new d3pie("#pie-chart", {
        "size": {
          "canvasWidth": 590,
          "pieInnerRadius": "66%",
          "pieOuterRadius": "90%"
        },
        data: {
          "sortOrder": "null",
          content: data,
        },
        "labels": {
          "outer": {
            "pieDistance": 24
          },
          "inner": {
            "hideWhenLessThanPercentage": 3
          },
          "mainLabel": {
            "color": "#e6e6e6",
            "fontSize": 11
          },
          "percentage": {
            "color": "#d2d2d2",
            "decimalPlaces": 0
          },
          "value": {
            "color": "#797979",
            "fontSize": 11
          },
          "lines": {
            "enabled": true,
            "color": "#ffffff"
          }
        },
        effects: {
          "pullOutSegmentOnClick": {
            "effect": "linear",
            "speed": 400,
            "size": 8
          },
          load: {
            effect: "default"
          }
        },
        "misc": {
          "colors": {
            "segmentStroke": "#747474"
          },
          "gradient": {
            "enabled": true,
            "percentage": 89
          }
        }
      });

    }     
    

  } // end updateTagList
  this.updateTagList();
} // end Piechart
